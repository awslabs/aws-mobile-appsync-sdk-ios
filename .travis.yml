language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "DkX2CpEj5AE9/FcBHW8HtqZsJUw6keiMocCZ5QbhvbejwjF6VqaTrI1n0xtX0g7jieIUyCtnsnKSlz67eR1l3m8Z/KGbDzG2sk8aBmutqcrXZWgI6TZE7HBl6olN3rSD6NNxU0WQeBm/kCucf9l90fZ/nIBotox15qpllLCH6pfPvIOSr7HkGNpcoJm1Pymspvf2G0QJ3klf5chFHZmp9EuLLIcxsR29YSy+eMer/Lw/j3IZn8at2nW0S6NDodWza4l2GSHul/mfgHiNxdU+dDAVx7YUNXo4KI7d/zgSwzagHzrH45kba9B/K4gKek3ygD4vCx9hLmV/ryxiDUl/CC1bea/nu6lQ52a73PpeKexfjKIFeg8pcdatxckUMFWywbqUB9R1UID8i6Etoza7TInvtIeYEPP7eopo+6rTwk6CZCn+2weQlrFIrk4LQ0uo/XDXeK7wsT/TtAz+qtHDq7aeGsk2FU+XPmxpgmPZofMGg9YZ2W2lIiJ13BbKpWdbQmevo4EdlO5OjiybVczW8H0UYrDDS1pIr+eWGUipZ875o7N7vzQfFUDRfTS3AliGPuNp6dgXiAyRZo9sCXMZ8ZY9I3uFUioI5rvwZT1ueDx1v1XauGo9aapSoRjUpTagRRWRaoNn8k8TO8yzU0ij1LrKmUt9oyyOvja6iyzeJdk="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
