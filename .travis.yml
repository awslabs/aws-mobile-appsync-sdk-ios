language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "W9lTdjpWxKomiK/fS9fKeF/dQ6FUQd9vHv1p0oRAjDWbg195E5sEm0LlWMtuArIjya58Xxol/SokpCxGmBo9URbbfK7FiEUA3V8bdQV+4kPJOr+72NgwPF8YiANtJig2kAq+h/0pCrHe3Aq8CE1dph28PIflDzGXPU5RUJAK/ZmLenpqWGX3sx8gahO4oAnCR/PG838vkGdW+upG9s62Zt8BsH5ZDeZQcnGVquY8Fq3k4nkQnmMx8h+NgbF5qDm4jpdESkWQ58Mj/fgnkp+MzgCzwRuJZyjqMbhK/8mlTeV25fHy2K8QXFLMPPnIdcfTLvCu4S1SdDnc05+XwfHcTqWxWvmfoa/Hzq5gAfc5F2F3lhiApTWArftm+9pBlzBlyi+Wr3fqsF7Vn2h6QI87txoAYv5H6Is1nG9YLyRSF4oKhK8/5aPjYjhpSqMGZo0jChVw8F3ZE4VzYdLZGZS6EUBffQo1qkhLF7fOE+HEaYz+qVpn82fTgTv4B6Rh+pRf6l30LBMZP9l/zDKzKlGhWnjJGzMk/jSOaXhmDkl8AIMrVXV/jkt11WT/PVq1jKQZDEHoVMZTE+sntfkh2RiiTKvKJr3YF1R0ukkttp4YppvNUSKOALcc/nHgJuGt9nJQM7K3rRJVsgZAVFdZKAvbMucmQCOe0NlD77bnRVRoQls="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
