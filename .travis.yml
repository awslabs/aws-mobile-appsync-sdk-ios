language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "j9VHRaF6i7EmgfOtKZeR8QEi6A/gGqcEYrfO3c8BYg87s0lx3/4N6KyUnvQoeEl9ycRknXn5bB1uCwug7nFCDFakY/4g9TqXW7ynLC8WZNPzp+VaVMWwEN1z9hua/C2B9PBfmCEtCgiRrBuz90ZSnkXOVtUx/OjPcy2rBLBTNX4UdGdSH/0x7koI/JHI2iBQanw2Fm6P2fsBogFb1kg2qBg54mXarhV52wggY01OxSlrwwis8tT8yflDryjAVH4V6CcvJVGLulkuh/sTjZK2KVIPNLE7VHZApTYWcLZxQmNsuUW5N1ZjsgALQR478oT0J6xZDU04xmJnvtJ8M5f6DAwv7HqBtj7YDY/UvD19YoC7yBOpPoMFKOdfDrnNrZSgRZeuyTvvFg3+vICftQ+/EQibajl9RwSDHP/qknKqPIadG2C5NfJypo5NFajS7IEB87iPY/HAoFknsgrUwhy2IiKXCr8JHFziUeC/ga9ksJJqtK5WXD0mbCSG/92MQ8ygfJ2TschVPqydvPJUrDRmAMdStQSPPWPbZ57OnJfdRxGYhzW9DgSu4lNvhF0Ow/5QxyQfXIQ0Laz6avYU1RR9CWsElUvn0KIV4hvXCgfSWbir23O0KzpBEFN4VGf9hmTCOOJP266KyeYUwaoeXaJjIJM7+n1ac5S3lT3hS1kEq9A="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
