language: swift
osx_image: xcode11
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.8.4'
before_deploy:
- carthage build --no-skip-current
- carthage archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "iRvn/f80BRF29xjM6xfNt/WEKFVWy2o8jybuKKPimjHu7yfEaMcfXql4NpfcPLZSLvwfAGqwAcbOpzVfWfrCPgepov4lnl9piC7e0hFOLoWkGz26te0/4DsFYdVn+lGnm9thd0eaCB97tcALMAmhD3p3pwuCHkcTYNMLJgCWsr3K8gm/le40yS4BmZoSq4pbTUnkIBhZRgzr0yXDxImwWoXtqp+o+OX9WwQleFU5m/jtbH1H6cCn+QH6kaDOLuwf/XK20wokZB4yl/rKBJrxKwLsAwFbBHUXjts32WqHHvrq1ukL7mowncs4vrozRybS5uivsF7WOlaw/j3Q9SOjXLX2NR4sULxrZ4jxv99CxImbLTZFBoYbEbE0gUgp1xI4BGm0ZWBPWvZTtGb+kpX0QawNnv+QHuV/ksuzRgf3IUSHoBDVLbPpw0o6Rbn+kUQgyyGQ4NlUA6IfeUHghKPitG9MF/sI5Qpyba/RknMqHeCyt+gqES4mkoO2+7k84tAglI2U6HFCoG+mEelyvscobzJGUYcFfkzclyMx77UxxvG9Qp6/NmcAgqEO22KQoNInCMNIkDUG87JIJbgoHRLBSHmokso/vit8hq0jnyXD97YTKciwQeOWnwNGmf1bRpOB6bFjMD3/6DqVpDLbpz7zGE0E+Bq29d6J7+kFadOi/Lw="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
