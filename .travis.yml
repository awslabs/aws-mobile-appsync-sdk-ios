language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "i7bRhFVBTd4cO5HSLu5znMp/tH9nvz+yKToRaqKF+kVK4rMmpPaGauYLtJ/XVDzwH6Ah6+SuIT9evnf2z+Uy8hyq7dVtUtq+wWLU9il5eR/3y3r242vH8nXvUT37rTSMh+pUqP/FM6/FF8XYAbvMBKXYMr4v1uBZ4wbQkaYzhL16k7+BvAqQgfmmUk+VGXhPepzqpeAc6CWi4r5L4X52XwUdxY9GHKsIb47hFu+nGM6kRueunK5H0mcX7xDBahNspvlP803VzTgrZbn8egAqYT/pT0M+xH80G4NQuqyvKNcireAONcjNj4UYyYCbp9Sq9Ov6JWdGK5dcSrcu1rXarcmxSm0oHmCIv9H8T0vd/61wVoFJ+cTBLbg7njCkhCR5N4+kvY4FFw/yajudVQZF2rBCbRVqzCrlW+qvU3DJrQBa+cK8DEwTY3CKnv8FqL/HHuHpw5mIZXys0eEqY72u3Vk84v3hsMBU0nmFcpXhPBr7Jn9yuWXVFA1gwgSunGGgnmBi/e6ZfDxrEYzm4oUKykxpM8uOKSz/L45VmhKBObOXe5c6BKc3XrG0UHn7kw8xrdVQGRb2rD4GcFO5RpVTJGNnKwMOnFh+FRkhI3F4lgK69DlFu1F3+BKwf+6wBt2jf7fmYNJPkrCuv0s9CAecjUTCeeBEYF2/L4AWxkzGoWs="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
