language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "Ksh7f406ig7ECPaUnsusD/ElZpRQ/TLgXMIznJUItyevy1RJT3rwBxd9hKwkceqagiMBuhDeD1+cGhXK5eaczhd4z92E5+YIrMSyZZyP3VxZpq0tzyedvQiJETqILYPZ35lLVirThG5EGRDaDfRsOZvgg/eYbPFUCZWW0W6tYq/f1tQjtSuEp2fgPrlrlvrWmU3NjZSlHIpz3MJYsaOBz+TP7uduZ8ja6o4WQB+VcVYOi6pC4e6pcGhf9wMvmBRQibBgnOszWJECsybSuz1mX56YOoqZmhbYjiYdy7LvOLM9O1HE0gIhSxSsiWmgVEgmCGjk6hMwbgvSyRDm37Wl2tzV1Yx6Y35vUjBPCrvJU/ITZvTg06Qv/ozqJLASmSQrT7cdg+gGVAWLY6rrHXNbjo669vWIZ4S7PFvKbnpIRt6zfz8RWaMfSjIyCCTy97VulZ5Cnpb71It7Hr4CgtW5+oT+Lu9rtDm/HjcOmNkRGyNR9C3Vwo9ZrBecOA32jF75SwXx/fcPn+TtiW2laBL2Kk3vxZvQiWFbg03U94f3Cku1YTx0OkpKXmg21spHv0xnZUWQv7IG6LhM617qFDIEeBSnbWuVbJi7JdI34uT8IvY+qU8DNcnG8TyPJvwQ5gtWMHAM5NEKc923Cmc8KgCIU+mCEcx6sQ0RZTAqjYbcEWU="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
