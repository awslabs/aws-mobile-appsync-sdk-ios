language: swift
osx_image: xcode12
env:
  global:
  - FRAMEWORK_NAME=AWSAppSync
xcode_workspace: AWSAppSyncClient.xcworkspace
xcode_scheme: AWSAppSync
before_install:
- openssl aes-256-cbc -K $encrypted_6919a533707f_key -iv $encrypted_6919a533707f_iv
  -in AWSAppSyncIntegrationTests/appsync_test_credentials.json.enc
  -out AWSAppSyncIntegrationTests/appsync_test_credentials.json
  -d
- brew update
- brew outdated carthage || brew upgrade carthage
- gem install cocoapods -v '1.9.3'
before_deploy:
- bash ./build-support/carthage-build.sh build --no-skip-current
- bash ./build-support/carthage-build.sh archive $FRAMEWORK_NAME
script:
- xcodebuild -quiet -workspace AWSAppSyncClient.xcworkspace -scheme AWSAppSync build test -destination 'platform=iOS Simulator,name=iPhone 11,OS=latest'
deploy:
- provider: releases
  api_key:
    secure: "fljROD9BJXK1N+l7fkCVH8Qck8DX47rMpvBNJBvpnaf+Vs7X1zp6w2lZtM5sk6zFvP5la0ooCZZWHtYUCxiiY3CCbrk78vSIfOjmgXEf0o+VR2N4eR2YY3BT0W7MRvCscOp7mL9OC2GvHmpBmbRx7N6GwaX8KZG90Sk7SLUtjgRE2B+4xFyEuTcxRNB7WxzzhBVuQ7fgii9YA1xWYjiYITFqsFxY0nZ05zde/sXYZMvjZiI/SgpP8Ps1AgN9bNnLOOHFgq9NFhkX1DnX9/4f0CLmveXUl36SRkD7/5ZnV7I93ZDTaZv6ySuJKP75IhD07snSV26ojAkScEcGw/ug5HWmsDzSx6qfi0P4KbAYmhL0cuYd04fHFVajIPDuy2c3L9ZUsDLX8/yw/u3uq6zj9K9iFimXx3fyjOVxrgLpIV4vypN0XFzHD5FlEIUjv9/9fzRaH98w0LtsIs1Z4nWUGnz0FvU+hyUTytXxtmNJ03Bo1ateYXigwWqYJPeprH80ykWUqLMXKdq02xfNcyPV54ZYWdTjPCEHuS95PaFR4ldJqMBPRJqm+N0Uqq4n98wi64RXmKEyE9Dooasw4q5HL/hnmsCZiweGsvGFLh38JO82v0sd0IMbXTbMueaz/AD0ijW0qZpDn+Y9unkANfe81lDJGl6pl7XIySgMD5jJqiM="
  file: "$FRAMEWORK_NAME.framework.zip"
  skip_cleanup: true
  on:
   repo: awslabs/aws-mobile-appsync-sdk-ios
   tags: true
- provider: script
  script: bash ./build-support/cocoapods_release.sh
  on:
    repo: awslabs/aws-mobile-appsync-sdk-ios
    tags: true
